---
title: Diagnose Problems in Workload Orchestration
description: Learn how to diagnose configuration, staging, deployment, and cloud problems across the workload orchestration lifecycle.
author: SoniaLopezBravo
ms.author: sonialopez
ms.topic: how-to
ms.date: 06/02/2025
---

# Diagnose of problems

This article describes how to diagnose problems during the workload orchestration lifecycle, including configuration, staging, deployment, cloud, and log issues.

## Validation and templating issues

Some common validation and templating issues include:

- Schema syntax errors, for example, missing or extra commas, incorrect brackets, non-YAML format, etc.
- Unsupported data types or invalid values, for example, using a string where an integer is expected.
- Missing required properties, for example, not specifying a required field in the configuration.
- Incorrect hierarchy levels, for example, placing a property at the wrong level in the configuration hierarchy.

These type of errors are visible in the [workload orchestration portal](configure.md) during the configuration phase. They can be resolved by correcting the syntax, ensuring all required fields are present, and validating the data types used.

## Staging and deployment failures

Some common staging failures include:

- Insufficient disk space on the connected registry. 
- Network latency or connectivity issues.
- Authentication errors with Azure Container Registry (ACR) or edge cluster. 
- Image download failures. 

Some common deployment failures include:

- Helm chart timeouts or failures.
- Application crash. 
- Missing or corrupted image/config files.
- Partial failures across lines with different root during bulk deployments.

Staging errors are visible in the "Published solutions" tab of the [workload orchestration portal](configure.md#view-the-published-solutions). Deployment errors are visible both in the [workload orchestration portal](deploy.md) and [Azure portal](azure-portal-monitoring.md). They can be resolved by checking the logs for specific error messages, ensuring sufficient resources are available, and verifying network connectivity.

## Cloud problems for IT users

Some common cloud problems include misconfigured RBAC permissions or policy restrictions, such as:รง

- Azure Monitor ingestion failures due to misconfigured diagnostic settings.
- Authentication failures or expired credentials.
- Regional latency or service outages.

These problems are visible in the Azure portal through the Azure Monitor service. They can be resolved by checking the diagnostic settings, ensuring proper RBAC permissions are in place, and verifying the health of Azure services in the region.

## Log problems

The following table summarizes the different types of logs that can be collected or generated by workload orchestration, container insights, and OTLP (OpenTelemetry logs) or syslogs. Click on the links in the "Reference" column to learn how to diagnose these logs problems.


| Log Category                                              | Purpose                                                                                                   | Reference                                                                                                   | Collected or Generated by                       | Destination                                         | How to Query                  | Collect Scope                                              | Send to User Space |
|-----------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------|------------------------------------------------------|-------------------------------|-----------------------------------------------------------|--------------------|
| Workload orchestration diagnostics logs emitted by workload orchestration extension | Monitor diagnostics information provided by workload orchestration extension on the edge, useful for troubleshooting end-to-end failures, like timeouts. | See [Enable workload orchestration level auditing and diagnostic logs](#enable-workload-orchestration-audit-and-diagnostic-logs)                          | Generated by workload orchestration extension                        | Diagnostics settings destination (storage account, Log Analytics workspace, etc.) | Query in Log Analytics workspace | Workload orchestration operations                                              | Yes               |
| Workload orchestration audit logs emitted by workload orchestration extension | Monitor invoking workload orchestration extension on the edge to modify workload orchestration objects or call workload orchestration extension API pod.        |  See [Enable workload orchestrationlevel auditing and diagnostic logs](#enable-workload-orchestration-audit-and-diagnostic-logs)                                    | Generated by workload orchestration extension                        | Diagnostics settings destination (storage account, Log Analytics workspace, etc.) | Query in Log Analytics workspace | Workload orchestration operations                                              | Yes               |
| Any container logs, Kubernetes events, or syslogs         | Monitor container logs from any Kubernetes applications.                                                   | See [Enable monitoring for Kubernetes clusters - Azure Monitor](/azure/azure-monitor/containers/kubernetes-monitoring-enable) | Collected by Container Insights extension         | Log Analytics workspace only                           | Query in Log Analytics workspace | All Kubernetes containers and Kubernetes events             | Yes               |
| Any OTLP (OpenTelemetry logs) or syslogs                  | Monitor OTLP (OpenTelemetry logs) or syslogs from any Kubernetes applications.                             | See [Configuration of Azure Monitor pipeline at edge and multicloud - Azure Monitor](/azure/azure-monitor/essentials/monitor-pipeline-controller) | Collected by microsoft.monitor.pipelinecontroller extension | Log Analytics workspace only                           | Query in Log Analytics workspace | Any apps (in cluster / outside of cluster); configure OTEL/syslog | Yes               |


### Enable workload orchestration audit and diagnostic logs

1. Create a `Microsoft.Edge/Diagnostics` resource per each Azure Arc-enabled Kubernetes cluster.

    ```powershell
    $diagnosticName = "default"
     
    az workload-orchestration diagnostic create `
    --subscription $subscriptionId `
    --resource-group $rg `
    --diagnostic-name $diagnosticName `
    --extended-location .\custom-location.json `
    --location $location
    ```

1. Create log analytics workspace, or use and existing one, to create a diagnostic setting.

    ```powershell
    $diagnosticLAId = "<your log analytics workspace id>"
    $diagnosticResourceId = (az workload-orchestration diagnostic show `
                                --subscription $subscriptionId `
                                --resource-group $rg `
                                --diagnostic-name $diagnosticName `
                                --query id -o tsv)
    az monitor diagnostic-settings create `
        --name diagSetting `
        --resource $diagnosticResourceId `
        --logs '[{"category":"UserAudits","enabled":true},{"category":"UserDiagnostics","enabled":true}]' `
        --workspace $diagnosticLAId
    ```

1. Go to [Azure portal](https://portal.azure.com). In the search bar, type "Log Analytics workspaces" and select it. Select your log analytics workspace.
1. In the log analytics workspace, select **Logs** from the left-hand menu. In the query editor, select the **Tables** tab. You see two new tables: WOUserAudits and WOUserDiagnostics.

    :::image type="content" source="./media/diagnose-audition-1.png" alt-text="Screenshot of Log Analytics workspaces showing the tables tab" lightbox="./media/diagnose-audition-1.png":::

    - By querying WOUserAudits logs, you can inspect who manipulated the edge workload orchestration resource and if their operation is to pull chart or install chart on the on-premise cluster.

    - By querying WOUserDiagnostics logs, you can inspect the detailed error logs reported by the workload orchestration extension for workload orchestration operations (such as installation).

1. In the **Queries** tab, you have some built-in queries to search for workload orchestration log events. The following table describes the parameters of the queries.

    :::image type="content" source="./media/diagnose-audition-2.png" alt-text="Screenshot of Log Analytics workspaces showing the queries tab." lightbox="./media/diagnose-audition-2.png":::
 

| Parameter                | Data type | Description                                                                                                                                         |
|--------------------------|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------|
| TimeGenerated            | DateTime  | Event generation time.                                                                                                                              |
| OperationName            | String    | Operation name of the event.                                                                                                                        |
| Category                 | String    | Category of the event.                                                                                                                              |
| Location                 | String    | Azure region in which the workload orchestration diagnostic resource is located.                                                                    |
| Properties               | Dynamic   | Properties of the event.                                                                                                                            |
| OperatingResourceId      | String    | The operating resource ID refers to the specific operational resource that the workload orchestration is managing when this event is triggered.      |
| OperatingResourceK8SId   | String    | The operating resource K8s ID refers to K8s resource ID (namespace/name) of the specific operational resource that the workload orchestration is managing when this event is triggered. |
| Message                  | String    | The audit message.                                                                                                                                  |
| User                     | Guid      | The Microsoft Entra ID object. ID of the requester.                                                                                                  |
| CorrelationId            | Guid      | Correlation ID of the operation.                                                                                                                    |
| WOServiceName            | String    | Workload orchestration service name.                                                                                                                |
| WOServiceInstance        | String    | Workload orchestration service pod name.                                                                                                            |
| EdgeLocation             | String    | The Azure Edge custom location resource ID on which the operation happens.                                                                          |
	

1. (Optional) You can turn off workload orchestration user-facing logs emission by running the following command:

    ```powershell
    # Delete diagnostics settings resource
    az monitor diagnostic-settings delete `
        --name diagSetting `
        --resource $diagnosticResourceId
    
    # Delete Microsoft.Edge/diagnostics resource
    az workload-orchestration diagnostic delete `
       --subscription $subscriptionId `
       --resource-group $rg `
       --diagnostic-name $diagnosticName
    ```

### Collect container logs or Kubernetes events

1. To collect container logs or Kubernetes events from the Azure Arc-enabled Kubernetes cluster you need to enable [Container insights in Azure Monitor](/azure/azure-monitor/containers/kubernetes-monitoring-enable?tabs=cli#arc-enabled-cluster-1).

1. Once you have enabled Container insights, you can use the following commands to collect logs and events using an existing Log Analytics workspace.

    ```powershell
    ### Use existing Log Analytics workspace
    az k8s-extension create --name azuremonitor-containers --cluster-name <cluster-name> --resource-group <resource-group> --cluster-type connectedClusters --extension-type Microsoft.AzureMonitor.Containers --configuration-settings logAnalyticsWorkspaceResourceID=<workspace-resource-id>
    ```

1. Go to your Log Analytics workspace in the Azure portal. If you haven't already, follow the steps in [Enable workload orchestration audit and diagnostic logs](#enable-workload-orchestration-audit-and-diagnostic-logs) to see how.
1. To inspect your container logs, add the following query in the query editor with your cluster ID and pod namespace. You can see all console logs collected to the cloud, which can help you identify if the solution crashes due to a business logic error.

    ```kusto
    ContainerLogV2
    | where _ResourceId contains "<your cluster ID>"
    | where PodNamespace contains "<your pod namespace>"
    ```

1. To inspect Kubernetes events, add the following query in the query editor with your cluster ID  You can see all Kubernetes events collected to the cloud, which can help you identify why the pod isn't started correctly, such as image pull fail, pod security context violation, persistent volume mounting issue, etc. In helm installation, you might only get a time-out error.

    ```kusto
    KubeEvents
    | where _ResourceId contains "<your cluster ID>"
    ```
